---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Resume" description="Resume and CV">
  <div id="password-gate">
    <h1>Resume</h1>
    <p class="text-muted">This page is password protected.</p>
    <form id="password-form">
      <input
        type="password"
        id="password-input"
        placeholder="Enter password"
        autocomplete="off"
      />
      <button type="submit">Submit</button>
    </form>
    <p id="error-message" class="error"></p>
  </div>

  <div id="resume-content" style="display: none;">
    <h1>Resume</h1>

    <p>
      <a href="/resume.pdf" download class="download-btn">Download PDF</a>
    </p>

    <section class="mt-lg">
      <h2>Experience</h2>
      <div class="entry">
        <h3>Fractal Tech</h3>
        <p class="text-muted">2025 - Present</p>
        <p>Learning to become a junior senior engineer.</p>
      </div>
      <div class="entry">
        <h3>[Previous Role]</h3>
        <p class="text-muted">[Dates]</p>
        <p>[Description]</p>
      </div>
    </section>

    <section class="mt-lg">
      <h2>Education</h2>
      <div class="entry">
        <h3>[School]</h3>
        <p class="text-muted">[Dates]</p>
        <p>[Degree/Details]</p>
      </div>
    </section>

    <section class="mt-lg">
      <h2>Skills</h2>
      <p>[Placeholder skills]</p>
    </section>
  </div>
</BaseLayout>

<style>
  #password-form {
    display: flex;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
  }

  #password-input {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: 4px;
    background: var(--color-bg);
    color: var(--color-text);
    font-size: 1rem;
  }

  #password-form button {
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--color-accent);
    color: var(--color-bg);
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.2s ease;
  }

  #password-form button:hover {
    background: var(--color-accent-hover);
  }

  .error {
    color: #e53e3e;
    margin-top: var(--spacing-sm);
  }

  .download-btn {
    display: inline-block;
    background: var(--color-accent);
    color: var(--color-bg);
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: 4px;
    font-weight: 500;
    transition: background 0.2s ease;
  }

  .download-btn:hover {
    background: var(--color-accent-hover);
    text-decoration: none;
  }

  .entry {
    margin-bottom: var(--spacing-lg);
  }

  .entry h3 {
    margin-bottom: 0.25rem;
  }

  .entry .text-muted {
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
  }
</style>

<script>
  const gate = document.getElementById('password-gate');
  const content = document.getElementById('resume-content');
  const form = document.getElementById('password-form');
  const input = document.getElementById('password-input') as HTMLInputElement;
  const errorMsg = document.getElementById('error-message');

  // Check if already unlocked this session
  if (sessionStorage.getItem('resume-unlocked') === 'true') {
    gate!.style.display = 'none';
    content!.style.display = 'block';
  }

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorMsg!.textContent = '';

    const password = input.value;

    try {
      const response = await fetch('/api/check-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password }),
      });

      const data = await response.json();

      if (data.success) {
        sessionStorage.setItem('resume-unlocked', 'true');
        gate!.style.display = 'none';
        content!.style.display = 'block';
      } else {
        errorMsg!.textContent = 'Incorrect password';
        input.value = '';
      }
    } catch (err) {
      errorMsg!.textContent = 'Something went wrong. Try again.';
    }
  });
</script>
